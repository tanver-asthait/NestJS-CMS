<div class="dashboard-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Welcome back, {{ user()?.firstName || 'Admin' }}!</h1>
      <p>{{ currentDate | date:'fullDate' }}</p>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading dashboard data...</p>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="alert alert-danger">
      <i class="bi bi-exclamation-triangle"></i>
      {{ error() }}
    </div>
  }

  <!-- Dashboard Content -->
  @if (!loading()) {
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon posts">
          <i class="bi bi-file-text"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats().totalPosts }}</h3>
          <p>Total Posts</p>
          <div class="stat-details">
            <span class="detail-item success">
              <i class="bi bi-check-circle"></i>
              {{ stats().publishedPosts }} Published
            </span>
            <span class="detail-item warning">
              <i class="bi bi-pencil"></i>
              {{ stats().draftPosts }} Drafts
            </span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon users">
          <i class="bi bi-people"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats().totalUsers }}</h3>
          <p>Total Users</p>
          <div class="stat-details">
            <span class="detail-item">Registered users in the system</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon categories">
          <i class="bi bi-tags"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats().totalCategories }}</h3>
          <p>Categories</p>
          <div class="stat-details">
            <span class="detail-item">Content organization</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon placements">
          <i class="bi bi-grid"></i>
        </div>
        <div class="stat-info">
          <h3>{{ stats().totalPlacements }}</h3>
          <p>Placements</p>
          <div class="stat-details">
            <span class="detail-item">Content placements</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
      <!-- Recent Posts -->
      <div class="dashboard-section recent-posts-section">
        <div class="section-header">
          <h3>
            <i class="bi bi-file-text"></i>
            Recent Posts
          </h3>
          <button class="btn btn-sm btn-primary" (click)="navigateTo('/posts')">
            View All
            <i class="bi bi-arrow-right"></i>
          </button>
        </div>

        @if (recentPosts().length === 0) {
          <div class="empty-state-small">
            <i class="bi bi-file-text"></i>
            <p>No posts yet</p>
          </div>
        } @else {
          <div class="posts-table-container">
            <table class="posts-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                @for (post of recentPosts(); track post._id) {
                  <tr>
                    <td>
                      <div class="post-title">{{ post.title }}</div>
                      @if (post.excerpt) {
                        <div class="post-excerpt">{{ post.excerpt }}</div>
                      }
                    </td>
                    <td>
                      <span class="badge" [ngClass]="getStatusBadgeClass(post.status)">
                        {{ post.status }}
                      </span>
                    </td>
                    <td>{{ formatDate(post.createdAt) }}</td>
                    <td>
                      <button
                        class="btn btn-sm btn-info"
                        (click)="navigateTo('/posts')"
                        title="View Post"
                      >
                        <i class="bi bi-eye"></i>
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>

      <!-- Recent Users -->
      <div class="dashboard-section recent-users-section">
        <div class="section-header">
          <h3>
            <i class="bi bi-people"></i>
            Recent Users
          </h3>
          <button class="btn btn-sm btn-primary" (click)="navigateTo('/users')">
            View All
            <i class="bi bi-arrow-right"></i>
          </button>
        </div>

        @if (recentUsers().length === 0) {
          <div class="empty-state-small">
            <i class="bi bi-people"></i>
            <p>No users yet</p>
          </div>
        } @else {
          <div class="users-list">
            @for (user of recentUsers(); track user._id) {
              <div class="user-item">
                <div class="user-avatar">
                  {{ user.firstName?.charAt(0) }}{{ user.lastName?.charAt(0) }}
                </div>
                <div class="user-details">
                  <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
                  <div class="user-email">{{ user.email }}</div>
                </div>
                <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">
                  {{ user.role }}
                </span>
              </div>
            }
          </div>
        }
      </div>

      <!-- Top Categories -->
      <div class="dashboard-section categories-section">
        <div class="section-header">
          <h3>
            <i class="bi bi-tags"></i>
            Categories
          </h3>
          <button class="btn btn-sm btn-primary" (click)="navigateTo('/categories')">
            View All
            <i class="bi bi-arrow-right"></i>
          </button>
        </div>

        @if (topCategories().length === 0) {
          <div class="empty-state-small">
            <i class="bi bi-tags"></i>
            <p>No categories yet</p>
          </div>
        } @else {
          <div class="categories-list">
            @for (category of topCategories(); track category._id) {
              <div class="category-item">
                <div class="category-icon">
                  <i class="bi bi-tag"></i>
                </div>
                <div class="category-details">
                  <div class="category-name">{{ category.name }}</div>
                  @if (category.description) {
                    <div class="category-description">{{ category.description }}</div>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Quick Actions -->
      <div class="dashboard-section actions-section">
        <div class="section-header">
          <h3>
            <i class="bi bi-lightning"></i>
            Quick Actions
          </h3>
        </div>

        <div class="actions-grid">
          <button class="action-btn" (click)="navigateTo('/posts')">
            <i class="bi bi-plus-circle"></i>
            <span>Create Post</span>
          </button>
          <button class="action-btn" (click)="navigateTo('/categories')">
            <i class="bi bi-tag"></i>
            <span>Add Category</span>
          </button>
          <button class="action-btn" (click)="navigateTo('/users')">
            <i class="bi bi-person-plus"></i>
            <span>Manage Users</span>
          </button>
          <button class="action-btn" (click)="navigateTo('/placements')">
            <i class="bi bi-grid"></i>
            <span>Placements</span>
          </button>
        </div>
      </div>
    </div>
  }
</div>
